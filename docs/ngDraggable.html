<!DOCTYPE html>

<html>
<head>
  <title>ngDraggable.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="app.html">
                  app.js
                </a>
              
                
                <a class="source" href="controllers.html">
                  controllers.js
                </a>
              
                
                <a class="source" href="ngDraggable.html">
                  ngDraggable.js
                </a>
              
                
                <a class="source" href="services.html">
                  services.js
                </a>
              
                
                <a class="source" href="xml2json.min.html">
                  xml2json.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>ngDraggable.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
 *
 * https://github.com/fatlinesofcode/ngDraggable
 */</span>
angular.module(<span class="hljs-string">"ngDraggable"</span>, [])
    .service(<span class="hljs-string">'ngDraggable'</span>, [<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{


        <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;
        scope.inputEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
            <span class="hljs-keyword">if</span> (angular.isDefined(event.touches)) {
                <span class="hljs-keyword">return</span> event.touches[<span class="hljs-number">0</span>];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Checking both is not redundent. If only check if touches isDefined, angularjs isDefnied will return error and stop the remaining scripty if event.originalEvent is not defined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (angular.isDefined(event.originalEvent) &amp;&amp; angular.isDefined(event.originalEvent.touches)) {
                <span class="hljs-keyword">return</span> event.originalEvent.touches[<span class="hljs-number">0</span>];
            }
            <span class="hljs-keyword">return</span> event;
        };

    }])
    .directive(<span class="hljs-string">'ngDrag'</span>, [<span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$document'</span>, <span class="hljs-string">'$window'</span>, <span class="hljs-string">'ngDraggable'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$rootScope, $parse, $document, $window, ngDraggable</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scope, element, attrs</span>) </span>{
                scope.value = attrs.ngDrag;
                <span class="hljs-keyword">var</span> offset,_centerAnchor=<span class="hljs-literal">false</span>,_mx,_my,_tx,_ty,_mrx,_mry;
                <span class="hljs-keyword">var</span> _hasTouch = (<span class="hljs-string">'ontouchstart'</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span>) || <span class="hljs-built_in">window</span>.DocumentTouch &amp;&amp; <span class="hljs-built_in">document</span> <span class="hljs-keyword">instanceof</span> DocumentTouch;
                <span class="hljs-keyword">var</span> _pressEvents = <span class="hljs-string">'touchstart mousedown'</span>;
                <span class="hljs-keyword">var</span> _moveEvents = <span class="hljs-string">'touchmove mousemove'</span>;
                <span class="hljs-keyword">var</span> _releaseEvents = <span class="hljs-string">'touchend mouseup'</span>;
                <span class="hljs-keyword">var</span> _dragHandle;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>to identify the element in order to prevent getting superflous events when a single element has both drag and drop directives on it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> _myid = scope.$id;
                <span class="hljs-keyword">var</span> _data = <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">var</span> _dragOffset = <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">var</span> _dragEnabled = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">var</span> _pressTimer = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> pressTimeout = attrs.pressTimeout || <span class="hljs-number">50</span>;

                <span class="hljs-keyword">var</span> onDragStartCallback = $parse(attrs.ngDragStart) || <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> onDragStopCallback = $parse(attrs.ngDragStop) || <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> onDragSuccessCallback = $parse(attrs.ngDragSuccess) || <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> allowTransform = angular.isDefined(attrs.allowTransform) ? scope.$<span class="hljs-built_in">eval</span>(attrs.allowTransform) : <span class="hljs-literal">true</span>;

                <span class="hljs-keyword">var</span> getDragData = $parse(attrs.ngDragData);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>deregistration function for mouse move events in $rootScope triggered by jqLite trigger handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> _deregisterRootMoveListener = angular.noop;

                <span class="hljs-keyword">var</span> initialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    element.attr(<span class="hljs-string">'draggable'</span>, <span class="hljs-string">'false'</span>); <span class="hljs-comment">// prevent native drag</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>check to see if drag handle(s) was specified
if querySelectorAll is available, we use this instead of find
as JQLite find is limited to tagnames</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (element[<span class="hljs-number">0</span>].querySelectorAll) {
                        <span class="hljs-keyword">var</span> dragHandles = angular.element(element[<span class="hljs-number">0</span>].querySelectorAll(<span class="hljs-string">'[ng-drag-handle]'</span>));
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">var</span> dragHandles = element.find(<span class="hljs-string">'[ng-drag-handle]'</span>);
                    }
                    <span class="hljs-keyword">if</span> (dragHandles.length) {
                        _dragHandle = dragHandles;
                    }
                    toggleListeners(<span class="hljs-literal">true</span>);
                };

                <span class="hljs-keyword">var</span> toggleListeners = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{
                    <span class="hljs-keyword">if</span> (!enable)<span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>add listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    scope.$on(<span class="hljs-string">'$destroy'</span>, onDestroy);
                    scope.$watch(attrs.ngDrag, onEnableChange);
                    scope.$watch(attrs.ngCenterAnchor, onCenterAnchor);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>wire up touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (_dragHandle) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>handle(s) specified, use those to initiate drag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        _dragHandle.on(_pressEvents, onpress);
                    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>no handle(s) specified, use the element as the handle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        element.on(_pressEvents, onpress);
                    }
                    <span class="hljs-keyword">if</span>(! _hasTouch &amp;&amp; element[<span class="hljs-number">0</span>].nodeName.toLowerCase() == <span class="hljs-string">"img"</span>){
                        element.on(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;}); <span class="hljs-comment">// prevent native drag for images</span>
                    }
                };
                <span class="hljs-keyword">var</span> onDestroy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{
                    toggleListeners(<span class="hljs-literal">false</span>);
                };
                <span class="hljs-keyword">var</span> onEnableChange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newVal, oldVal</span>) </span>{
                    _dragEnabled = (newVal);
                };
                <span class="hljs-keyword">var</span> onCenterAnchor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newVal, oldVal</span>) </span>{
                    <span class="hljs-keyword">if</span>(angular.isDefined(newVal))
                        _centerAnchor = (newVal || <span class="hljs-string">'true'</span>);
                };

                <span class="hljs-keyword">var</span> isClickableElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">return</span> (
                        angular.isDefined(angular.element(evt.target).attr(<span class="hljs-string">"ng-cancel-drag"</span>))
                    );
                };
                <span class="hljs-comment">/*
                 * When the element is clicked start the drag behaviour
                 * On touch devices as a small delay so as not to prevent native window scrolling
                 */</span>
                <span class="hljs-keyword">var</span> onpress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">if</span>(! _dragEnabled)<span class="hljs-keyword">return</span>;

                    <span class="hljs-keyword">if</span> (isClickableElement(evt)) {
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">if</span> (evt.type == <span class="hljs-string">"mousedown"</span> &amp;&amp; evt.button != <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Do not start dragging on right-click</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">return</span>;
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>if(_hasTouch){
    cancelPress();
    _pressTimer = setTimeout(function(){
        cancelPress();
        onlongpress(evt);
    },pressTimeout);
    $document.on(_moveEvents, cancelPress);
    $document.on(_releaseEvents, cancelPress);
}else{</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        onlongpress(evt);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                };

                <span class="hljs-keyword">var</span> cancelPress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    clearTimeout(_pressTimer);
                    $<span class="hljs-built_in">document</span>.off(_moveEvents, cancelPress);
                    $<span class="hljs-built_in">document</span>.off(_releaseEvents, cancelPress);
                };

                <span class="hljs-keyword">var</span> onlongpress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">if</span>(! _dragEnabled)<span class="hljs-keyword">return</span>;
                    evt.preventDefault();

                    offset = element[<span class="hljs-number">0</span>].getBoundingClientRect();
                    <span class="hljs-keyword">if</span>(allowTransform)
                        _dragOffset = offset;
                    <span class="hljs-keyword">else</span>{
                        _dragOffset = {<span class="hljs-attr">left</span>:<span class="hljs-built_in">document</span>.body.scrollLeft, <span class="hljs-attr">top</span>:<span class="hljs-built_in">document</span>.body.scrollTop};
                    }


                    element.centerX = element[<span class="hljs-number">0</span>].offsetWidth / <span class="hljs-number">2</span>;
                    element.centerY = element[<span class="hljs-number">0</span>].offsetHeight / <span class="hljs-number">2</span>;

                    _mx = ngDraggable.inputEvent(evt).pageX;<span class="hljs-comment">//ngDraggable.getEventProp(evt, 'pageX');</span>
                    _my = ngDraggable.inputEvent(evt).pageY;<span class="hljs-comment">//ngDraggable.getEventProp(evt, 'pageY');</span>
                    _mrx = _mx - offset.left;
                    _mry = _my - offset.top;
                    <span class="hljs-keyword">if</span> (_centerAnchor) {
                        _tx = _mx - element.centerX - $<span class="hljs-built_in">window</span>.pageXOffset;
                        _ty = _my - element.centerY - $<span class="hljs-built_in">window</span>.pageYOffset;
                    } <span class="hljs-keyword">else</span> {
                        _tx = _mx - _mrx - $<span class="hljs-built_in">window</span>.pageXOffset;
                        _ty = _my - _mry - $<span class="hljs-built_in">window</span>.pageYOffset;
                    }

                    $<span class="hljs-built_in">document</span>.on(_moveEvents, onmove);
                    $<span class="hljs-built_in">document</span>.on(_releaseEvents, onrelease);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This event is used to receive manually triggered mouse move events
jqLite unfortunately only supports triggerHandler(…)
See <a href="http://api.jquery.com/triggerHandler/">http://api.jquery.com/triggerHandler/</a>
_deregisterRootMoveListener = $rootScope.$on(‘draggable:_triggerHandlerMove’, onmove);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    _deregisterRootMoveListener = $rootScope.$on(<span class="hljs-string">'draggable:_triggerHandlerMove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, origEvent</span>) </span>{
                        onmove(origEvent);
                    });
                };

                <span class="hljs-keyword">var</span> onmove = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">if</span> (!_dragEnabled)<span class="hljs-keyword">return</span>;
                    evt.preventDefault();

                    <span class="hljs-keyword">if</span> (!element.hasClass(<span class="hljs-string">'dragging'</span>)) {
                        _data = getDragData(scope);
                        element.addClass(<span class="hljs-string">'dragging'</span>);
                        $rootScope.$broadcast(<span class="hljs-string">'draggable:start'</span>, {<span class="hljs-attr">x</span>:_mx, <span class="hljs-attr">y</span>:_my, <span class="hljs-attr">tx</span>:_tx, <span class="hljs-attr">ty</span>:_ty, <span class="hljs-attr">event</span>:evt, <span class="hljs-attr">element</span>:element, <span class="hljs-attr">data</span>:_data});

                        <span class="hljs-keyword">if</span> (onDragStartCallback ){
                            scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                onDragStartCallback(scope, {<span class="hljs-attr">$data</span>: _data, <span class="hljs-attr">$event</span>: evt});
                            });
                        }
                    }

                    _mx = ngDraggable.inputEvent(evt).pageX;<span class="hljs-comment">//ngDraggable.getEventProp(evt, 'pageX');</span>
                    _my = ngDraggable.inputEvent(evt).pageY;<span class="hljs-comment">//ngDraggable.getEventProp(evt, 'pageY');</span>

                    <span class="hljs-keyword">if</span> (_centerAnchor) {
                        _tx = _mx - element.centerX - _dragOffset.left;
                        _ty = _my - element.centerY - _dragOffset.top;
                    } <span class="hljs-keyword">else</span> {
                        _tx = _mx - _mrx - _dragOffset.left;
                        _ty = _my - _mry - _dragOffset.top;
                    }

                    moveElement(_tx, _ty);

                    $rootScope.$broadcast(<span class="hljs-string">'draggable:move'</span>, { <span class="hljs-attr">x</span>: _mx, <span class="hljs-attr">y</span>: _my, <span class="hljs-attr">tx</span>: _tx, <span class="hljs-attr">ty</span>: _ty, <span class="hljs-attr">event</span>: evt, <span class="hljs-attr">element</span>: element, <span class="hljs-attr">data</span>: _data, <span class="hljs-attr">uid</span>: _myid, <span class="hljs-attr">dragOffset</span>: _dragOffset });
                };

                <span class="hljs-keyword">var</span> onrelease = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">if</span> (!_dragEnabled)
                        <span class="hljs-keyword">return</span>;
                    evt.preventDefault();
                    $rootScope.$broadcast(<span class="hljs-string">'draggable:end'</span>, {<span class="hljs-attr">x</span>:_mx, <span class="hljs-attr">y</span>:_my, <span class="hljs-attr">tx</span>:_tx, <span class="hljs-attr">ty</span>:_ty, <span class="hljs-attr">event</span>:evt, <span class="hljs-attr">element</span>:element, <span class="hljs-attr">data</span>:_data, <span class="hljs-attr">callback</span>:onDragComplete, <span class="hljs-attr">uid</span>: _myid});
                    element.removeClass(<span class="hljs-string">'dragging'</span>);
                    element.parent().find(<span class="hljs-string">'.drag-enter'</span>).removeClass(<span class="hljs-string">'drag-enter'</span>);
                    reset();
                    $<span class="hljs-built_in">document</span>.off(_moveEvents, onmove);
                    $<span class="hljs-built_in">document</span>.off(_releaseEvents, onrelease);

                    <span class="hljs-keyword">if</span> (onDragStopCallback ){
                        scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            onDragStopCallback(scope, {<span class="hljs-attr">$data</span>: _data, <span class="hljs-attr">$event</span>: evt});
                        });
                    }

                    _deregisterRootMoveListener();
                };

                <span class="hljs-keyword">var</span> onDragComplete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{


                    <span class="hljs-keyword">if</span> (!onDragSuccessCallback )<span class="hljs-keyword">return</span>;

                    scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        onDragSuccessCallback(scope, {<span class="hljs-attr">$data</span>: _data, <span class="hljs-attr">$event</span>: evt});
                    });
                };

                <span class="hljs-keyword">var</span> reset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span>(allowTransform)
                        element.css({<span class="hljs-attr">transform</span>:<span class="hljs-string">''</span>, <span class="hljs-string">'z-index'</span>:<span class="hljs-string">''</span>, <span class="hljs-string">'-webkit-transform'</span>:<span class="hljs-string">''</span>, <span class="hljs-string">'-ms-transform'</span>:<span class="hljs-string">''</span>});
                    <span class="hljs-keyword">else</span>
                        element.css({<span class="hljs-string">'position'</span>:<span class="hljs-string">''</span>,<span class="hljs-attr">top</span>:<span class="hljs-string">''</span>,<span class="hljs-attr">left</span>:<span class="hljs-string">''</span>});
                };

                <span class="hljs-keyword">var</span> moveElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{
                    <span class="hljs-keyword">if</span>(allowTransform) {
                        element.css({
                            <span class="hljs-attr">transform</span>: <span class="hljs-string">'matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, '</span> + x + <span class="hljs-string">', '</span> + y + <span class="hljs-string">', 0, 1)'</span>,
                            <span class="hljs-string">'z-index'</span>: <span class="hljs-number">99999</span>,
                            <span class="hljs-string">'-webkit-transform'</span>: <span class="hljs-string">'matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, '</span> + x + <span class="hljs-string">', '</span> + y + <span class="hljs-string">', 0, 1)'</span>,
                            <span class="hljs-string">'-ms-transform'</span>: <span class="hljs-string">'matrix(1, 0, 0, 1, '</span> + x + <span class="hljs-string">', '</span> + y + <span class="hljs-string">')'</span>
                        });
                    }<span class="hljs-keyword">else</span>{
                        element.css({<span class="hljs-string">'left'</span>:x+<span class="hljs-string">'px'</span>,<span class="hljs-string">'top'</span>:y+<span class="hljs-string">'px'</span>, <span class="hljs-string">'position'</span>:<span class="hljs-string">'fixed'</span>});
                    }
                };
                initialize();
            }
        };
    }])

    .directive(<span class="hljs-string">'ngDrop'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$window'</span>, <span class="hljs-string">'$document'</span>, <span class="hljs-string">'ngDraggable'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$parse, $timeout, $window, $document, ngDraggable</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scope, element, attrs</span>) </span>{
                scope.value = attrs.ngDrop;
                scope.isTouching = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">var</span> _lastDropTouch=<span class="hljs-literal">null</span>;

                <span class="hljs-keyword">var</span> _myid = scope.$id;

                <span class="hljs-keyword">var</span> _dropEnabled=<span class="hljs-literal">false</span>;

                <span class="hljs-keyword">var</span> onDropCallback = $parse(attrs.ngDropSuccess);<span class="hljs-comment">// || function(){};</span>

                <span class="hljs-keyword">var</span> onDragStartCallback = $parse(attrs.ngDragStart);
                <span class="hljs-keyword">var</span> onDragStopCallback = $parse(attrs.ngDragStop);
                <span class="hljs-keyword">var</span> onDragMoveCallback = $parse(attrs.ngDragMove);

                <span class="hljs-keyword">var</span> initialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    toggleListeners(<span class="hljs-literal">true</span>);
                };

                <span class="hljs-keyword">var</span> toggleListeners = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>remove listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    <span class="hljs-keyword">if</span> (!enable)<span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>add listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    scope.$watch(attrs.ngDrop, onEnableChange);
                    scope.$on(<span class="hljs-string">'$destroy'</span>, onDestroy);
                    scope.$on(<span class="hljs-string">'draggable:start'</span>, onDragStart);
                    scope.$on(<span class="hljs-string">'draggable:move'</span>, onDragMove);
                    scope.$on(<span class="hljs-string">'draggable:end'</span>, onDragEnd);
                };

                <span class="hljs-keyword">var</span> onDestroy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{
                    toggleListeners(<span class="hljs-literal">false</span>);
                };
                <span class="hljs-keyword">var</span> onEnableChange = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">newVal, oldVal</span>) </span>{
                    _dropEnabled=newVal;
                };
                <span class="hljs-keyword">var</span> onDragStart = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, obj</span>) </span>{
                    <span class="hljs-keyword">if</span>(! _dropEnabled)<span class="hljs-keyword">return</span>;
                    isTouching(obj.x,obj.y,obj.element);

                    <span class="hljs-keyword">if</span> (attrs.ngDragStart) {
                        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                            onDragStartCallback(scope, {<span class="hljs-attr">$data</span>: obj.data, <span class="hljs-attr">$event</span>: obj});
                        });
                    }
                };
                <span class="hljs-keyword">var</span> onDragMove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, obj</span>) </span>{
                    <span class="hljs-keyword">if</span>(! _dropEnabled)<span class="hljs-keyword">return</span>;
                    isTouching(obj.x,obj.y,obj.element);

                    <span class="hljs-keyword">if</span> (attrs.ngDragMove) {
                        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                            onDragMoveCallback(scope, {<span class="hljs-attr">$data</span>: obj.data, <span class="hljs-attr">$event</span>: obj});
                        });
                    }
                };

                <span class="hljs-keyword">var</span> onDragEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, obj</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>don’t listen to drop events if this is the element being dragged
only update the styles and return</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (!_dropEnabled || _myid === obj.uid) {
                        updateDragStyles(<span class="hljs-literal">false</span>, obj.element);
                        <span class="hljs-keyword">return</span>;
                    }
                    <span class="hljs-keyword">if</span> (isTouching(obj.x, obj.y, obj.element)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>call the ngDraggable ngDragSuccess element callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span>(obj.callback){
                            obj.callback(obj);
                        }

                        <span class="hljs-keyword">if</span> (attrs.ngDropSuccess) {
                            $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                                onDropCallback(scope, {<span class="hljs-attr">$data</span>: obj.data, <span class="hljs-attr">$event</span>: obj, <span class="hljs-attr">$target</span>: scope.$<span class="hljs-built_in">eval</span>(scope.value)});
                            });
                        }
                    }

                    <span class="hljs-keyword">if</span> (attrs.ngDragStop) {
                        $timeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                            onDragStopCallback(scope, {<span class="hljs-attr">$data</span>: obj.data, <span class="hljs-attr">$event</span>: obj});
                        });
                    }

                    updateDragStyles(<span class="hljs-literal">false</span>, obj.element);
                };

                <span class="hljs-keyword">var</span> isTouching = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mouseX, mouseY, dragElement</span>) </span>{
                    <span class="hljs-keyword">var</span> touching= hitTest(mouseX, mouseY);
                    scope.isTouching = touching;
                    <span class="hljs-keyword">if</span>(touching){
                        _lastDropTouch = element;
                    }
                    updateDragStyles(touching, dragElement);
                    <span class="hljs-keyword">return</span> touching;
                };

                <span class="hljs-keyword">var</span> updateDragStyles = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">touching, dragElement</span>) </span>{
                    <span class="hljs-keyword">if</span>(touching){
                        element.addClass(<span class="hljs-string">'drag-enter'</span>);
                        dragElement.addClass(<span class="hljs-string">'drag-over'</span>);
                    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_lastDropTouch == element){
                        _lastDropTouch=<span class="hljs-literal">null</span>;
                        element.removeClass(<span class="hljs-string">'drag-enter'</span>);
                        dragElement.removeClass(<span class="hljs-string">'drag-over'</span>);
                    }
                };

                <span class="hljs-keyword">var</span> hitTest = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) </span>{
                    <span class="hljs-keyword">var</span> bounds = element[<span class="hljs-number">0</span>].getBoundingClientRect();<span class="hljs-comment">// ngDraggable.getPrivOffset(element);</span>
                    x -= $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].body.scrollLeft + $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollLeft;
                    y -= $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].body.scrollTop + $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollTop;
                    <span class="hljs-keyword">return</span>  x &gt;= bounds.left
                        &amp;&amp; x &lt;= bounds.right
                        &amp;&amp; y &lt;= bounds.bottom
                        &amp;&amp; y &gt;= bounds.top;
                };

                initialize();
            }
        };
    }])
    .directive(<span class="hljs-string">'ngDragClone'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'ngDraggable'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$parse, $timeout, ngDraggable</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scope, element, attrs</span>) </span>{
                <span class="hljs-keyword">var</span> img, _allowClone=<span class="hljs-literal">true</span>;
                <span class="hljs-keyword">var</span> _dragOffset = <span class="hljs-literal">null</span>;
                scope.clonedData = {};
                <span class="hljs-keyword">var</span> initialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

                    img = element.find(<span class="hljs-string">'img'</span>);
                    element.attr(<span class="hljs-string">'draggable'</span>, <span class="hljs-string">'false'</span>);
                    img.attr(<span class="hljs-string">'draggable'</span>, <span class="hljs-string">'false'</span>);
                    reset();
                    toggleListeners(<span class="hljs-literal">true</span>);
                };


                <span class="hljs-keyword">var</span> toggleListeners = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>remove listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    <span class="hljs-keyword">if</span> (!enable)<span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>add listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    scope.$on(<span class="hljs-string">'draggable:start'</span>, onDragStart);
                    scope.$on(<span class="hljs-string">'draggable:move'</span>, onDragMove);
                    scope.$on(<span class="hljs-string">'draggable:end'</span>, onDragEnd);
                    preventContextMenu();

                };
                <span class="hljs-keyword">var</span> preventContextMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p> element.off(‘mousedown touchstart touchmove touchend touchcancel’, absorbEvent_);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    img.off(<span class="hljs-string">'mousedown touchstart touchmove touchend touchcancel'</span>, absorbEvent_);</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p> element.on(‘mousedown touchstart touchmove touchend touchcancel’, absorbEvent_);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    img.on(<span class="hljs-string">'mousedown touchstart touchmove touchend touchcancel'</span>, absorbEvent_);
                };
                <span class="hljs-keyword">var</span> onDragStart = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, obj, elm</span>) </span>{
                    _allowClone=<span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">if</span>(angular.isDefined(obj.data.allowClone)){
                        _allowClone=obj.data.allowClone;
                    }
                    <span class="hljs-keyword">if</span>(_allowClone) {
                        scope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                            scope.clonedData = obj.data;
                        });
                        element.css(<span class="hljs-string">'width'</span>, obj.element[<span class="hljs-number">0</span>].offsetWidth);
                        element.css(<span class="hljs-string">'height'</span>, obj.element[<span class="hljs-number">0</span>].offsetHeight);

                        moveElement(obj.tx, obj.ty);
                    }

                };
                <span class="hljs-keyword">var</span> onDragMove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, obj</span>) </span>{
                    <span class="hljs-keyword">if</span>(_allowClone) {

                        _tx = obj.tx + obj.dragOffset.left;
                        _ty = obj.ty + obj.dragOffset.top;

                        moveElement(_tx, _ty);
                    }
                };
                <span class="hljs-keyword">var</span> onDragEnd = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt, obj</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>moveElement(obj.tx,obj.ty);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span>(_allowClone) {
                        reset();
                    }
                };

                <span class="hljs-keyword">var</span> reset = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    element.css({<span class="hljs-attr">left</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">top</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">position</span>:<span class="hljs-string">'fixed'</span>, <span class="hljs-string">'z-index'</span>:<span class="hljs-number">-1</span>, <span class="hljs-attr">visibility</span>:<span class="hljs-string">'hidden'</span>});
                };
                <span class="hljs-keyword">var</span> moveElement = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x,y</span>) </span>{
                    element.css({
                        <span class="hljs-attr">transform</span>: <span class="hljs-string">'matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, '</span>+x+<span class="hljs-string">', '</span>+y+<span class="hljs-string">', 0, 1)'</span>, <span class="hljs-string">'z-index'</span>: <span class="hljs-number">99999</span>, <span class="hljs-string">'visibility'</span>: <span class="hljs-string">'visible'</span>,
                        <span class="hljs-string">'-webkit-transform'</span>: <span class="hljs-string">'matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, '</span>+x+<span class="hljs-string">', '</span>+y+<span class="hljs-string">', 0, 1)'</span>,
                        <span class="hljs-string">'-ms-transform'</span>: <span class="hljs-string">'matrix(1, 0, 0, 1, '</span>+x+<span class="hljs-string">', '</span>+y+<span class="hljs-string">')'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>,margin: ‘0’  don’t monkey with the margin,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    });
                };

                <span class="hljs-keyword">var</span> absorbEvent_ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-keyword">var</span> e = event;<span class="hljs-comment">//.originalEvent;</span>
                    e.preventDefault &amp;&amp; e.preventDefault();
                    e.stopPropagation &amp;&amp; e.stopPropagation();
                    e.cancelBubble = <span class="hljs-literal">true</span>;
                    e.returnValue = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                };

                initialize();
            }
        };
    }])
    .directive(<span class="hljs-string">'ngPreventDrag'</span>, [<span class="hljs-string">'$parse'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$parse, $timeout</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scope, element, attrs</span>) </span>{
                <span class="hljs-keyword">var</span> initialize = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

                    element.attr(<span class="hljs-string">'draggable'</span>, <span class="hljs-string">'false'</span>);
                    toggleListeners(<span class="hljs-literal">true</span>);
                };


                <span class="hljs-keyword">var</span> toggleListeners = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">enable</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>remove listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                    <span class="hljs-keyword">if</span> (!enable)<span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>add listeners.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    element.on(<span class="hljs-string">'mousedown touchstart touchmove touchend touchcancel'</span>, absorbEvent_);
                };


                <span class="hljs-keyword">var</span> absorbEvent_ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-keyword">var</span> e = event.originalEvent;
                    e.preventDefault &amp;&amp; e.preventDefault();
                    e.stopPropagation &amp;&amp; e.stopPropagation();
                    e.cancelBubble = <span class="hljs-literal">true</span>;
                    e.returnValue = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                };

                initialize();
            }
        };
    }])
    .directive(<span class="hljs-string">'ngCancelDrag'</span>, [<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scope, element, attrs</span>) </span>{
                element.find(<span class="hljs-string">'*'</span>).attr(<span class="hljs-string">'ng-cancel-drag'</span>, <span class="hljs-string">'ng-cancel-drag'</span>);
            }
        };
    }])
    .directive(<span class="hljs-string">'ngDragScroll'</span>, [<span class="hljs-string">'$window'</span>, <span class="hljs-string">'$interval'</span>, <span class="hljs-string">'$timeout'</span>, <span class="hljs-string">'$document'</span>, <span class="hljs-string">'$rootScope'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$window, $interval, $timeout, $document, $rootScope</span>) </span>{
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">restrict</span>: <span class="hljs-string">'A'</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope, element, attrs</span>) </span>{
                <span class="hljs-keyword">var</span> intervalPromise = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">var</span> lastMouseEvent = <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">var</span> config = {
                    <span class="hljs-attr">verticalScroll</span>: attrs.verticalScroll || <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">horizontalScroll</span>: attrs.horizontalScroll || <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">activationDistance</span>: attrs.activationDistance || <span class="hljs-number">75</span>,
                    <span class="hljs-attr">scrollDistance</span>: attrs.scrollDistance || <span class="hljs-number">15</span>
                };


                <span class="hljs-keyword">var</span> reqAnimFrame = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.requestAnimationFrame ||
                        <span class="hljs-built_in">window</span>.webkitRequestAnimationFrame ||
                        <span class="hljs-built_in">window</span>.mozRequestAnimationFrame ||
                        <span class="hljs-built_in">window</span>.oRequestAnimationFrame ||
                        <span class="hljs-built_in">window</span>.msRequestAnimationFrame ||
                        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> <span class="hljs-regexp">/* function FrameRequestCallback */</span> callback, <span class="hljs-regexp">/* DOMElement Element */</span> element </span>) </span>{
                            <span class="hljs-built_in">window</span>.setTimeout(callback, <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>);
                        };
                })();

                <span class="hljs-keyword">var</span> animationIsOn = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">var</span> createInterval = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    animationIsOn = <span class="hljs-literal">true</span>;

                    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextFrame</span>(<span class="hljs-params">callback</span>) </span>{
                        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                        <span class="hljs-keyword">if</span>(animationIsOn) {
                            reqAnimFrame(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                $rootScope.$apply(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                                    callback.apply(<span class="hljs-literal">null</span>, args);
                                    nextFrame(callback);
                                });
                            })
                        }
                    }

                    nextFrame(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                        <span class="hljs-keyword">if</span> (!lastMouseEvent) <span class="hljs-keyword">return</span>;

                        <span class="hljs-keyword">var</span> viewportWidth = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">document</span>.documentElement.clientWidth, <span class="hljs-built_in">window</span>.innerWidth || <span class="hljs-number">0</span>);
                        <span class="hljs-keyword">var</span> viewportHeight = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">document</span>.documentElement.clientHeight, <span class="hljs-built_in">window</span>.innerHeight || <span class="hljs-number">0</span>);

                        <span class="hljs-keyword">var</span> scrollX = <span class="hljs-number">0</span>;
                        <span class="hljs-keyword">var</span> scrollY = <span class="hljs-number">0</span>;

                        <span class="hljs-keyword">if</span> (config.horizontalScroll) {</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If horizontal scrolling is active.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (lastMouseEvent.clientX &lt; config.activationDistance) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>If the mouse is on the left of the viewport within the activation distance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                scrollX = -config.scrollDistance;
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lastMouseEvent.clientX &gt; viewportWidth - config.activationDistance) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>If the mouse is on the right of the viewport within the activation distance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                scrollX = config.scrollDistance;
                            }
                        }

                        <span class="hljs-keyword">if</span> (config.verticalScroll) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If vertical scrolling is active.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (lastMouseEvent.clientY &lt; config.activationDistance) {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If the mouse is on the top of the viewport within the activation distance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                scrollY = -config.scrollDistance;
                            }
                            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lastMouseEvent.clientY &gt; viewportHeight - config.activationDistance) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If the mouse is on the bottom of the viewport within the activation distance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                                scrollY = config.scrollDistance;
                            }
                        }



                        <span class="hljs-keyword">if</span> (scrollX !== <span class="hljs-number">0</span> || scrollY !== <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Record the current scroll position.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> currentScrollLeft = ($<span class="hljs-built_in">window</span>.pageXOffset || $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollLeft);
                            <span class="hljs-keyword">var</span> currentScrollTop = ($<span class="hljs-built_in">window</span>.pageYOffset || $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollTop);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Remove the transformation from the element, scroll the window by the scroll distance
record how far we scrolled, then reapply the element transformation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> elementTransform = element.css(<span class="hljs-string">'transform'</span>);
                            element.css(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'initial'</span>);

                            $<span class="hljs-built_in">window</span>.scrollBy(scrollX, scrollY);

                            <span class="hljs-keyword">var</span> horizontalScrollAmount = ($<span class="hljs-built_in">window</span>.pageXOffset || $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollLeft) - currentScrollLeft;
                            <span class="hljs-keyword">var</span> verticalScrollAmount =  ($<span class="hljs-built_in">window</span>.pageYOffset || $<span class="hljs-built_in">document</span>[<span class="hljs-number">0</span>].documentElement.scrollTop) - currentScrollTop;

                            element.css(<span class="hljs-string">'transform'</span>, elementTransform);

                            lastMouseEvent.pageX += horizontalScrollAmount;
                            lastMouseEvent.pageY += verticalScrollAmount;

                            $rootScope.$emit(<span class="hljs-string">'draggable:_triggerHandlerMove'</span>, lastMouseEvent);
                        }

                    });
                };

                <span class="hljs-keyword">var</span> clearInterval = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    animationIsOn = <span class="hljs-literal">false</span>;
                };

                scope.$on(<span class="hljs-string">'draggable:start'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, obj</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Ignore this event if it’s not for this element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (obj.element[<span class="hljs-number">0</span>] !== element[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span>;

                    <span class="hljs-keyword">if</span> (!animationIsOn) createInterval();
                });

                scope.$on(<span class="hljs-string">'draggable:end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, obj</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Ignore this event if it’s not for this element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (obj.element[<span class="hljs-number">0</span>] !== element[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span>;

                    <span class="hljs-keyword">if</span> (animationIsOn) clearInterval();
                });

                scope.$on(<span class="hljs-string">'draggable:move'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event, obj</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Ignore this event if it’s not for this element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (obj.element[<span class="hljs-number">0</span>] !== element[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span>;

                    lastMouseEvent = obj.event;
                });
            }
        };
    }]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
